<!--
  http://bl.ocks.org/fancellu/2c782394602a93921faff74e594d1bb1
  https://github.com/sveltejs/realworld/blob/688379caec5c2807aa4c61a67f3707a36db9de0a/src/routes/article/_CommentContainer.html
  https://stackoverflow.com/questions/10100742/modelling-a-simple-graph-with-nodes-and-edges
	https://github.com/nodeca/js-yaml
  -->

<textarea id="story" rows="30"></textarea>

<button class="loader" on:click="load()">Load it up!</button>

<svg class="visual_story"></svg>


<style>
  #story {
    max-width: 100ch;
  }

  .visual_story {
    height: 600px;
    width: 960px;
  }

  .loader {
    max-width: 10rem;
  }

  /* Need a nasty global here because it's unused until later and we don't want svelte
     stripping it*/
  :global(svg.visual_story .link) {
    stroke: #999;
    stroke-opacity: .6;
    stroke-width: 1px;
  }
</style>

<script>
  import yaml from 'js-yaml';
  import { draw } from '../../lib/story_graphs.js';

  let simulation;

  export default {
    methods: {
      load() {
        const data = document.querySelector("#story").value;
        if(simulation) simulation.stop();
        simulation = draw(yaml.safeLoad(data), "svg.visual_story");
      }
    },
    async oncreate() {
      const story = document.querySelector("#story");
      story.value = yaml.safeDump({"nodes":[{"name":"Peter","label":"Person","id":1},{"name":"Michael","label":"Person","id":2},{"name":"Neo4j","label":"Database","id":3},{"name":"Graph Database","label":"Database","id":4}],"links":[{"source":1,"target":2,"type":"KNOWS","since":2010},{"source":1,"target":3,"type":"FOUNDED"},{"source":2,"target":3,"type":"WORKS_ON"},{"source":3,"target":4,"type":"IS_A"}]});
    }
  }
</script>
