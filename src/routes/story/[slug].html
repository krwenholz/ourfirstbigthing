<svelte:head>
  <title>{story.title}</title>
</svelte:head>

<Adventure {story} {title} />

<script>
  export default {
    preload({ params, query }) {
      return this.fetch(`story/${params.slug}.json`, { credentials: 'include' }).then((res) => {
        if (res.status == 200) {
          return res.json();
        } else if(res.status == 401) {
          this.redirect(302, '/login');
        } else {
          console.error(res);
          this.error(res.status, res);
        }
      }).then((data) => {
        return {
          story: data.content,
          title: data.title,
        };
      });
    },
    components: {
      Adventure: '../../components/Adventure.html',
    }
  };
</script>
